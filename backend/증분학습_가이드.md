# 증분 학습 (Incremental Learning) 가이드

기존에 학습한 데이터를 유지하면서 새로운 PDF만 추가로 학습하는 방법입니다.

## 📋 개요

- **증분 학습**: 기존 벡터 DB는 그대로 두고, 새로운 PDF만 학습하여 추가
- **전체 학습**: 모든 PDF를 처음부터 다시 학습 (기존 데이터 삭제)

## 🚀 사용 방법

### 1. 새로운 PDF 파일 추가

`backend/data/raw/` 폴더에 새로운 PDF 파일을 넣으세요.

```bash
backend/
  data/
    raw/
      ├── existing.pdf      # 이미 학습된 파일
      ├── new_document.pdf  # 🆕 새로 추가한 파일
      └── another_new.pdf   # 🆕 새로 추가한 파일
```

### 2. 증분 학습 실행

```bash
cd backend
python run_incremental_learning.py
```

**결과:**
- ✅ `new_document.pdf`와 `another_new.pdf`만 학습
- ✅ `existing.pdf`는 건너뜀 (이미 학습됨)
- ✅ 기존 벡터 DB에 새로운 데이터 추가

### 3. 서버 재시작

```bash
python run_server.py
```

새로운 데이터가 즉시 반영됩니다!

## 🛠️ 고급 사용법

### 처리된 파일 목록 확인

현재 어떤 파일들이 학습되었는지 확인:

```bash
python run_incremental_learning.py --list
```

**출력 예시:**
```
처리된 파일 목록 (3개):
  [1] document1.pdf
  [2] document2.pdf
  [3] existing.pdf
```

### 특정 파일 다시 학습

이미 학습된 파일을 다시 학습하고 싶을 때:

```bash
python run_incremental_learning.py --force
```

**주의:** 
- 기존 데이터는 유지되고, 모든 파일을 다시 학습하여 **중복 추가**됩니다.
- 중복을 피하려면 전체 재학습을 권장합니다.

### 전체 재학습 (처음부터 다시)

기존 학습 데이터를 모두 삭제하고 처음부터 다시 학습:

#### 방법 1: 처리된 파일 목록만 초기화

```bash
python run_incremental_learning.py --reset
```

이후 다음 번 실행 시 모든 PDF를 다시 학습합니다.

#### 방법 2: 벡터 DB 완전 삭제 후 재학습

```bash
# 1. 기존 벡터 DB 삭제
rm -rf data/vector_store/*

# 2. 전체 학습 실행
python run_preprocessing.py        # JSON 데이터용
# 또는
python run_incremental_learning.py # PDF 데이터용
```

## 📊 작동 원리

### 증분 학습 프로세스

1. **기존 데이터 로드**
   - FAISS 인덱스 로드 (`faiss_index.bin`)
   - 메타데이터 로드 (`metadata.pkl`)
   - 처리된 파일 목록 로드 (`processed_files.json`)

2. **새 파일 감지**
   - `data/raw/` 폴더의 모든 PDF 스캔
   - 처리된 파일 목록과 비교
   - 새로운 파일만 필터링

3. **새 파일만 처리**
   - PDF 로드 및 청크 생성
   - 임베딩 생성
   - 기존 FAISS 인덱스에 추가

4. **저장**
   - 업데이트된 FAISS 인덱스 저장
   - 업데이트된 메타데이터 저장
   - 처리된 파일 목록 업데이트

### 파일 구조

```
backend/data/vector_store/
  ├── faiss_index.bin        # 벡터 인덱스
  ├── metadata.pkl           # 메타데이터
  └── processed_files.json   # 처리된 파일 목록 (새로 생성됨)
```

## 🔄 기존 방법과 비교

### 기존 방법 (전체 재학습)

```bash
python run_preprocessing.py        # JSON용
python -m src.pipeline_pdf_batch data/raw  # PDF용
```

- ❌ 매번 모든 파일을 처음부터 다시 학습
- ❌ 시간이 오래 걸림
- ❌ AWS Bedrock API 비용 증가

### 증분 학습 (새 방법)

```bash
python run_incremental_learning.py
```

- ✅ 새로운 파일만 학습
- ✅ 빠른 처리
- ✅ API 비용 절약
- ✅ 기존 데이터 보존

## ⚠️ 주의사항

1. **파일 이름 기반 추적**
   - 파일 이름으로 처리 여부를 판단합니다
   - 같은 이름의 파일을 수정한 경우, `--force` 옵션으로 재학습하세요

2. **벡터 DB 백업**
   - 중요한 데이터는 정기적으로 백업하세요
   ```bash
   cp -r data/vector_store data/vector_store_backup_$(date +%Y%m%d)
   ```

3. **메모리 관리**
   - 매우 큰 PDF는 메모리 부족 오류가 발생할 수 있습니다
   - 필요시 청크 크기를 조정하세요 (`chunk_size=1000` → `chunk_size=500`)

## 📞 문제 해결

### "처리할 새로운 PDF 파일이 없습니다"

모든 파일이 이미 학습되었습니다. 새 파일을 추가하거나 `--force` 옵션을 사용하세요.

### 특정 파일만 다시 학습하고 싶을 때

1. 처리된 파일 목록에서 해당 파일 제거:
   ```bash
   # processed_files.json 파일을 직접 편집
   code data/vector_store/processed_files.json
   ```

2. 다시 학습:
   ```bash
   python run_incremental_learning.py
   ```

### 벡터 DB가 손상되었을 때

완전히 삭제하고 재학습:

```bash
rm -rf data/vector_store/*
python run_incremental_learning.py
```

## 💡 팁

- 개발 중에는 증분 학습으로 빠르게 테스트
- 프로덕션 배포 전에는 전체 재학습으로 데이터 정합성 보장
- 정기적으로 벡터 DB 백업

